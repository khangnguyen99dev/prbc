"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[962],{2962:(G,y,d)=>{d.r(y),d.d(y,{ManagerModule:()=>E});var g=d(6895),m=d(2605),e=d(1571),T=d(6690),f=d(5861),h=d(1822),p=d(2340),A=d(5439),v=d(6548),x=d(12),u=d(433),b=d(9602);function C(r,s){if(1&r){const a=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.updateUser())}),e._uU(1),e.qZA()}if(2&r){const a=e.oxw();e.Q6J("disabled",a.loading),e.xp6(1),e.hij(" ",a.loading?"Loading...":"Update"," ")}}let U=(()=>{const s=class{constructor(t,i){this.route=t,this.permissionService=i,this.modelId=null,this.form={entity_id:"",name:"",employee_number:"",email:"",date_of_birth:"",password:"",confirm_password:"",entityObject:null},this.loading=!1,this.errorMessages=[],this.successMessage="",this.entities=[]}ngOnInit(){var t=this;return(0,f.Z)(function*(){yield t.setForm(),yield t.setupSelectize(),t.route.queryParams.subscribe(i=>{i.success_message&&(window.scrollTo(0,0),t.successMessage="User created successfully",t.clearMessages())})})()}setForm(){var t=this;return(0,f.Z)(function*(){t.loading=!0,yield h.Z.get(`${p.N.api_url}/settings/users/${t.modelId}`,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${window.localStorage.getItem(p.N.api_token_identifier)}`}}).then(n=>{if(n.data.error)return t.errorMessages.push(n.data.error_message),window.scrollTo(0,0),t.loading=!1,void t.clearMessages();let l=n.data.user;t.form.name=l.name,t.form.employee_number=l.employee_number,t.form.email=l.email,t.form.date_of_birth=l.date_of_birth,t.form.entity_id=l.entity_id,t.form.entityObject=l.entity,t.loading=!1}).catch(n=>{console.error(n),422==n.response.status?Object.keys(n.response.data.errors).forEach(l=>{t.errorMessages.push(n.response.data.errors[l])}):t.errorMessages.push("Sorry, something went wrong. Please try again later."),window.scrollTo(0,0),t.loading=!1,t.clearMessages()})})()}updateUser(){this.errorMessages=[],this.successMessage="",this.loading=!0,this.form.date_of_birth&&(this.form.date_of_birth=A(this.form.date_of_birth).format("YYYY-MM-DD")),h.Z.put(`${p.N.api_url}/settings/users/${this.modelId}`,this.form,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${window.localStorage.getItem(p.N.api_token_identifier)}`}}).then(t=>{if(t.data.error)return this.errorMessages.push(t.data.error_message),window.scrollTo(0,0),this.loading=!1,void this.clearMessages();this.successMessage=t.data.success_message,window.scrollTo(0,0),setTimeout(()=>{this.successMessage="",this.loading=!1},3500)}).catch(t=>{console.error(t),422==t.response.status?Object.keys(t.response.data.errors).forEach(i=>{this.errorMessages.push(t.response.data.errors[i])}):this.errorMessages.push("Sorry, something went wrong. Please try again later."),window.scrollTo(0,0),this.loading=!1,this.clearMessages()})}clearMessages(){setTimeout(()=>{this.successMessage=""},3500)}setupSelectize(){var t=this;return(0,f.Z)(function*(){const i=t;$(function(){const l=$("#entity_selectize").selectize({preload:!0,valueField:"id",searchField:"label",labelField:"label",load:(c,o)=>{$("#fetching_entity").show(),$.ajax({url:`${p.N.api_url}/settings/entities?search_selectize=${c}`,type:"GET",error:function(){o(),$("#fetching_entity").hide()},success:_=>{o(_?.entities?.data),$("#fetching_entity").hide()},headers:{Authorization:`Bearer ${window.localStorage.getItem(p.N.api_token_identifier)}`,"Content-Type":"application/json"}})},onChange:c=>{i.form.entity_id=c}})[0].selectize;i.form.entity_id&&(l.addOption(i.form.entityObject),l.setValue(i.form.entityObject.id))})})()}};let r=s;return s.\u0275fac=function(i){return new(i||s)(e.Y36(m.gz),e.Y36(v.$))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-user-details"]],inputs:{modelId:"modelId"},decls:51,vars:12,consts:[[3,"errorMessages","successMessage"],[1,"grid","gap-5","lg:gap-7.5","w-full","mx-auto"],[1,"card","pb-2.5"],["id","basic_settings",1,"card-header"],[1,"card-title"],[1,"card-body","grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"flex","items-center","flex-wrap","lg:flex-nowrap","gap-2.5"],[1,"form-label","max-w-56"],[1,"text-danger"],["id","fetching_entity",1,"pt-2","text-sm",2,"display","none"],["name","entity_selectize","id","entity_selectize",1,"w-full"],["value",""],[1,"flex","items-baseline","flex-wrap","lg:flex-nowrap","gap-2.5"],["type","text","placeholder","Enter name",1,"input",3,"ngModel","ngModelChange"],["type","text","placeholder","Enter employee number",1,"input",3,"disabled","ngModel","ngModelChange"],["type","text","placeholder","Enter email",1,"input",3,"disabled","ngModel","ngModelChange"],["name","date_of_birth","placeholder","Select Date of Birth",1,"input","w-full",3,"matDatepicker","ngModel","click","ngModelChange"],["hidden",""],["date_of_birth",""],["placeholder","Enter password","type","password",1,"input",3,"ngModel","ngModelChange"],[1,"flex","items-center","flex-wrap","lg:flex-nowrap","gap-2.5","mb-2.5"],["placeholder","Enter confirm password","type","password",1,"input",3,"ngModel","ngModelChange"],[1,"card-body","flex","justify-end"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(i,n){if(1&i){const l=e.EpF();e._UZ(0,"app-alert",0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),e._uU(5," User Information "),e.qZA()(),e.TgZ(6,"div",5)(7,"div",6)(8,"label",7),e._uU(9," Entity "),e.TgZ(10,"span",8),e._uU(11,"\xa0*"),e.qZA()(),e.TgZ(12,"p",9),e._uU(13,"Fetching Entities..."),e.qZA(),e.TgZ(14,"select",10)(15,"option",11),e._uU(16,"Select Entity"),e.qZA()()(),e.TgZ(17,"div",12)(18,"label",7),e._uU(19," Name "),e.TgZ(20,"span",8),e._uU(21,"\xa0*"),e.qZA()(),e.TgZ(22,"input",13),e.NdJ("ngModelChange",function(o){return n.form.name=o}),e.qZA()(),e.TgZ(23,"div",6)(24,"label",7),e._uU(25," Employee Number "),e.TgZ(26,"span",8),e._uU(27,"\xa0*"),e.qZA()(),e.TgZ(28,"input",14),e.NdJ("ngModelChange",function(o){return n.form.employee_number=o}),e.qZA()(),e.TgZ(29,"div",6)(30,"label",7),e._uU(31," Email "),e.TgZ(32,"span",8),e._uU(33,"\xa0*"),e.qZA()(),e.TgZ(34,"input",15),e.NdJ("ngModelChange",function(o){return n.form.email=o}),e.qZA()(),e.TgZ(35,"div",6)(36,"label",7),e._uU(37," Date of Birth "),e.qZA(),e.TgZ(38,"input",16),e.NdJ("click",function(){e.CHM(l);const o=e.MAs(40);return e.KtG(o.open())})("ngModelChange",function(o){return n.form.date_of_birth=o}),e.qZA(),e._UZ(39,"mat-datepicker",17,18),e.qZA(),e.TgZ(41,"div",6)(42,"label",7),e._uU(43," Password "),e.qZA(),e.TgZ(44,"input",19),e.NdJ("ngModelChange",function(o){return n.form.password=o}),e.qZA()(),e.TgZ(45,"div",20)(46,"label",7),e._uU(47," Confirm Password "),e.qZA(),e.TgZ(48,"input",21),e.NdJ("ngModelChange",function(o){return n.form.confirm_password=o}),e.qZA()()(),e.TgZ(49,"div",22),e.YNc(50,C,2,2,"button",23),e.qZA()()()}if(2&i){const l=e.MAs(40);e.Q6J("errorMessages",n.errorMessages)("successMessage",n.successMessage),e.xp6(22),e.Q6J("ngModel",n.form.name),e.xp6(6),e.Q6J("disabled","admin@admin.com"===n.form.email)("ngModel",n.form.employee_number),e.xp6(6),e.Q6J("disabled","admin@admin.com"===n.form.email)("ngModel",n.form.email),e.xp6(4),e.Q6J("matDatepicker",l)("ngModel",n.form.date_of_birth),e.xp6(6),e.Q6J("ngModel",n.form.password),e.xp6(4),e.Q6J("ngModel",n.form.confirm_password),e.xp6(2),e.Q6J("ngIf",n.permissionService.hasPermission("Settings - Master Data - Can Update User Management"))}},dependencies:[g.O5,x.w,u.YN,u.Kr,u.Fj,u.JJ,u.On,b.Mq,b.hl]}),r})();function I(r,s){if(1&r&&(e.TgZ(0,"option",26),e._uU(1),e.qZA()),2&r){const a=s.$implicit,t=e.oxw().$implicit;e.Q6J("value",t.key+"|||"+a.role_name),e.xp6(1),e.hij(" ",a.label," ")}}function S(r,s){if(1&r&&(e.TgZ(0,"tr",16)(1,"td",17)(2,"div",18),e._uU(3),e.qZA()(),e.TgZ(4,"td",19)(5,"div")(6,"label",20),e._uU(7,"Select Roles"),e.TgZ(8,"span",21),e._uU(9,"*"),e.qZA()(),e.TgZ(10,"p",22),e._uU(11,"Fetching Vendors..."),e.qZA(),e.TgZ(12,"div",23)(13,"select",24),e.YNc(14,I,2,2,"option",25),e.qZA()()()()()),2&r){const a=s.$implicit;e.xp6(3),e.Oqu(a.name),e.xp6(10),e.Q6J("id","roles_selectize_"+a.key),e.xp6(1),e.Q6J("ngForOf",a.roles)}}function k(r,s){1&r&&(e.TgZ(0,"tbody",13)(1,"tr",27)(2,"td",28),e.O4$(),e.TgZ(3,"svg",29),e._UZ(4,"path",30)(5,"path",31),e.qZA(),e.kcU(),e.TgZ(6,"p",32),e._uU(7,"Loading..."),e.qZA()()()())}function J(r,s){if(1&r&&(e.TgZ(0,"div")(1,"table",9)(2,"thead")(3,"tr",10)(4,"th",11),e._uU(5," Application "),e.qZA(),e.TgZ(6,"th",12),e._uU(7," Roles "),e.qZA()()(),e.TgZ(8,"tbody",13),e.YNc(9,S,15,3,"tr",14),e.qZA(),e.YNc(10,k,8,0,"tbody",15),e.qZA()()),2&r){const a=e.oxw();e.xp6(9),e.Q6J("ngForOf",a.installedApplications),e.xp6(1),e.Q6J("ngIf",a.settingUp&&!a.successSetup)}}function z(r,s){if(1&r){const a=e.EpF();e.TgZ(0,"button",33),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.save())}),e._uU(1),e.qZA()}if(2&r){const a=e.oxw();e.Q6J("disabled",a.saving),e.xp6(1),e.hij(" ",a.saving?"Saving...":"Save Access"," ")}}let N=(()=>{const s=class{constructor(t,i){this.route=t,this.permissionService=i,this.modelId=null,this.errorMessages=[],this.successMessage="",this.settingUp=!0,this.successSetup=!1,this.saving=!1,this.permissionFormControl=new u.NI,this.user=[],this.installedApplications=[],this.roles=[],this.roleSelected=[]}setup(){var t=this;return(0,f.Z)(function*(){t.settingUp=!0;try{const n=yield(yield h.Z.get(`${p.N.api_url}/settings/users/${t.modelId}`,{headers:{Authorization:`Bearer ${window.localStorage.getItem(p.N.api_token_identifier)}`}})).data;if(t.settingUp=!1,n.error)return t.errorMessages.push(n.error_message),void window.scrollTo(0,0);t.user=n.user,t.installedApplications=Object.values(n.installed_applications),t.roles=n.roles;for(let[l,c]of t.installedApplications.entries()){for(let o of c.roles)t.roles.includes(o.role_name)&&t.roleSelected.push(c.key+"|||"+o.role_name);t.roleSelected[l]||t.roleSelected.push("")}setTimeout(()=>{t.setupSelectize()},200),t.successSetup=!0}catch(i){console.log(i),t.settingUp=!1}})()}setupSelectize(){for(let[t,i]of this.installedApplications.entries()){let n=$("#roles_selectize_"+i.key);n.selectize();let l=[];for(let c of i.roles)this.roles.includes(c.role_name)&&l.push(i.key+"|||"+c.role_name);n[0].selectize.setValue(l)}}hasRole(t){return!(null==t||""===t||!this.roles.includes(t))}save(){var t=this;return(0,f.Z)(function*(){t.errorMessages=[];try{t.saving=!0;const i=[];for(let[_,P]of t.installedApplications.entries()){const K=$("#roles_selectize_"+P.key).val();i.push(...K)}const n={user_id:t.modelId,roles:i},c=yield(yield h.Z.post(`${p.N.api_url}/settings/user-access-managements/assign-role`,n,{headers:{Authorization:`Bearer ${window.localStorage.getItem(p.N.api_token_identifier)}`,"Content-Type":"application/json",Accept:"application/json"}})).data;if(t.saving=!1,c.error)return t.errorMessages.push(c.error_message),void window.scrollTo(0,0);const o=t;t.successMessage=c.success_message,setTimeout(()=>{o.successMessage=""},3500),window.scrollTo(0,0)}catch(i){t.saving=!1,console.log(i),window.scrollTo(0,0)}})()}ngOnInit(){this.modelId=this.route.snapshot.params.id,this.setup()}};let r=s;return s.\u0275fac=function(i){return new(i||s)(e.Y36(m.gz),e.Y36(v.$))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-access-management"]],inputs:{modelId:"modelId"},decls:10,vars:4,consts:[[3,"errorMessages","successMessage"],[1,"grid","gap-5","lg:gap-7.5","mx-auto"],[1,"card","pb-2.5"],["id","basic_settings",1,"card-header"],[1,"card-title"],[1,"card-body","grid","gap-5"],[4,"ngIf"],[1,"flex","justify-end"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],[1,"flex","flex-col","divide-y","divide-gray-200","mt-5","border-gray-200"],[1,"flex","items-center","px-1"],["scope","col",1,"w-6/12","hidden","sm:table-cell","pr-6","pl-0","text-left","py-3","text-xs","font-medium","text-black","tracking-wider","font-bold"],["scope","col",1,"w-6/12","hidden","sm:table-cell","pr-6","text-left","py-3","text-xs","font-medium","text-black","tracking-wider","font-bold"],["data-table-body","true"],["data-table-list","","class","relative flex items-center px-1 group border-b hover:bg-gray-100",4,"ngFor","ngForOf"],["data-table-body","true",4,"ngIf"],["data-table-list","",1,"relative","flex","items-center","px-1","group","border-b","hover:bg-gray-100"],[1,"w-6/12","pr-6","text-left","cursor-pointer","py-2","pl-0","px-3","whitespace-nowrap","text-sm","font-normal","text-black","truncate"],[1,"font-medium","truncate","flex"],[1,"w-6/12","pr-6","text-left","cursor-pointer","py-2","text-sm","font-normal","text-black"],["for","vendor_id",1,"text-black","text-sm","font-medium"],[1,"text-red","ltr:ml-1","rtl:mr-1"],["id","fetching_vendor_id",1,"pt-2","text-sm",2,"display","none"],[1,"pt-1"],["multiple","",3,"id"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["data-table-list","",1,"relative","flex","items-center","px-1","group","border-b"],["colspan","4",1,"w-full","pr-6","text-center","py-5","px-3","whitespace-nowrap","text-sm","font-normal","text-black","truncate"],["aria-hidden","true","viewBox","0 0 100 101","fill","none","xmlns","http://www.w3.org/2000/svg",1,"w-10","h-10","m-auto","text-gray-200","animate-spin","dark:text-gray-600","fill-green-600"],["d","M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z","fill","currentColor"],["d","M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z","fill","currentFill"],[1,"text-center","mt-5"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(i,n){1&i&&(e._UZ(0,"app-alert",0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),e._uU(5," Manage User Access Roles "),e.qZA()(),e.TgZ(6,"div",5),e.YNc(7,J,11,2,"div",6),e.TgZ(8,"div",7),e.YNc(9,z,2,2,"button",8),e.qZA()()()()),2&i&&(e.Q6J("errorMessages",n.errorMessages)("successMessage",n.successMessage),e.xp6(7),e.Q6J("ngIf",!n.settingUp&&n.successSetup),e.xp6(2),e.Q6J("ngIf",n.permissionService.hasPermission("Settings - Master Data - Can Assign Role User Management")))},dependencies:[g.sg,g.O5,x.w]}),r})();function q(r,s){if(1&r&&(e.ynx(0),e._UZ(1,"app-user-details",11),e.BQk()),2&r){const a=e.oxw();e.xp6(1),e.Q6J("modelId",a.modelId)}}function j(r,s){if(1&r&&(e.ynx(0),e._UZ(1,"app-access-management",11),e.BQk()),2&r){const a=e.oxw();e.xp6(1),e.Q6J("modelId",a.modelId)}}const Z=function(r){return[r]},F=function(){return{tab:"user_details"}},Q=function(){return{tab:"access_management"}};let O=(()=>{const s=class{constructor(t,i,n){this.router=t,this.headerService=i,this.route=n,this.modelId=0,this.user={},this.currentTab="user_details",this.form={name:"",email:"",password:"",confirm_password:""},this.headerService.setupHeader([{title:"Settings"},{title:"Master Data"},{title:"User Management",link:"/settings/master-data/user-management"},{title:"Manager User"}])}ngOnInit(){this.modelId=this.route.snapshot.params.id,this.route.queryParams.subscribe(t=>{this.currentTab=t.tab??"user_details"})}};let r=s;return s.\u0275fac=function(i){return new(i||s)(e.Y36(m.F0),e.Y36(T.r),e.Y36(m.gz))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-manager"]],decls:18,vars:16,consts:[[1,"container-fixed"],[1,"flex","items-center","flex-wrap","md:flex-nowrap","lg:items-end","justify-between","border-b","border-b-gray-200","dark:border-b-coal-100","gap-3","lg:gap-6","mb-2"],[1,"grid"],[1,"scrollable-x-auto"],["data-menu","true",1,"menu","gap-3"],[1,"menu-item","border-b-2","border-b-transparent","menu-item-active:border-b-primary","menu-item-here:border-b-primary"],["tabindex","0",1,"menu-link","gap-1.5","pb-2","lg:pb-4","px-2",3,"routerLink","queryParams"],[1,"menu-title","text-nowrap","font-medium","text-sm","text-gray-700","menu-item-active:text-primary","menu-item-active:font-semibold","menu-item-here:text-primary","menu-item-here:font-semibold","menu-item-show:text-primary","menu-link-hover:text-primary"],[1,"flex","items-center","justify-end","grow","lg:grow-0","lg:pb-4","gap-2.5","mb-3","lg:mb-0"],["routerLink","/settings/master-data/user-management",1,"btn","btn-sm","btn-light"],[4,"ngIf"],[3,"modelId"]],template:function(i,n){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"a",6)(7,"span",7),e._uU(8," User details "),e.qZA()()(),e.TgZ(9,"div",5)(10,"a",6)(11,"span",7),e._uU(12," Access Management "),e.qZA()()()()()(),e.TgZ(13,"div",8)(14,"button",9),e._uU(15," Back "),e.qZA()()(),e.YNc(16,q,2,1,"ng-container",10),e.YNc(17,j,2,1,"ng-container",10),e.qZA()),2&i&&(e.xp6(5),e.ekj("active","user_details"===n.currentTab),e.xp6(1),e.Q6J("routerLink",e.VKq(10,Z,"/settings/master-data/user-management/"+n.modelId))("queryParams",e.DdM(12,F)),e.xp6(3),e.ekj("active","access_management"===n.currentTab),e.xp6(1),e.Q6J("routerLink",e.VKq(13,Z,"/settings/master-data/user-management/"+n.modelId))("queryParams",e.DdM(15,Q)),e.xp6(6),e.Q6J("ngIf","user_details"===n.currentTab),e.xp6(1),e.Q6J("ngIf","access_management"===n.currentTab))},dependencies:[g.O5,m.rH,U,N]}),r})();var M=d(5730),w=d(3238);let Y=(()=>{const s=class{};let r=s;return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({providers:[{provide:w.Ad,useValue:"en-GB"}],imports:[g.ez,m.Bz,M.n,u.u5,b.FA,w.XK]}),r})(),B=(()=>{const s=class{};let r=s;return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[g.ez,m.Bz,M.n]}),r})();const D=[{path:"",component:O}];let E=(()=>{const s=class{};let r=s;return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[g.ez,m.Bz.forChild(D),u.u5,Y,B,m.Bz]}),r})()}}]);